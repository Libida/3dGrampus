<!DOCTYPE HTML>
<html>
<head>
    <style>
        body {
            margin: 0px;
            padding: 0px;
        }
    </style>
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>

</head>
<body>
<div id="container"></div>
<script src="js/three.js"></script>
<script defer="defer">
    // revolutions per second
    var angularSpeed = 0.2;
    var lastTime = 0;
    var count = 0.1;

    function animate() {

        requestAnimationFrame( animate );

        grampus.moveBody();

    }


    var grampus = {
        settings: {
            threeJS: {
                renderer: {},
                camera: {},
                scene: {}
            },
            anatomy: {
                body: {
                    bodyGeometricObject: {},
                    cylinders: {
                        count: 4,
                        diameter: {
                            start: 50,
                            end: 150,
                            diff: 25
                        }
                    }
                }
            },
            mouse: {
                x: 0,
                y: 0
            }
        },

        init: function () {
            this.initThreeJS();
            this.drawBody();
            this.bindEvents();
            animate();
        },

        bindEvents: function () {
            var self = this;
            document.addEventListener( 'mousemove', self.onMouseMove, false );
        },

        onMouseMove: function (event) {
            var mouse = grampus.settings.mouse;
            mouse.x = ( event.clientX - window.innerWidth / 2 );
            mouse.y =  - ( event.clientY - window.innerHeight / 2 );
        },

        moveBody: function () {
            var self = this,
                body = self.settings.anatomy.body.bodyGeometricObject,
                bodyCylinders = body.children,
                coordinates = self.settings.mouse;

            for (var i = 0; i < bodyCylinders.length; i++) {
                var currentCylinder = bodyCylinders[i],
                        currentY = coordinates.y + i *50;
                currentCylinder.position.x = coordinates.x;
                currentCylinder.position.y = Math.sin( ( i*2 + count ) * 0.3 ) * 10;
                count += 0.03;
            }
            grampus.renderThreeJSResults();

        },



        initThreeJS: function () {
            var threeJS = this.settings.threeJS;
            threeJS.renderer = new THREE.WebGLRenderer();
            threeJS.renderer.setSize(window.innerWidth - 20, window.innerHeight - 20);
            document.body.appendChild(threeJS.renderer.domElement);
            threeJS.camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 1000);
            threeJS.camera.position.z = 700;
            threeJS.scene = new THREE.Scene();
        },

        renderThreeJSResults: function () {
            var threeJS = this.settings.threeJS;
            threeJS.renderer.render(threeJS.scene, threeJS.camera);
        },

        drawBody: function () {
            var selfSettings = this.settings,
                    scene = selfSettings.threeJS.scene,
                    body = selfSettings.anatomy.body,
                    currentCircleDiameter = body.cylinders.diameter.start,
                    diameterDiff = body.cylinders.diameter.diff,
                    currentZ = 0;
            body.bodyGeometricObject = new THREE.Object3D();
            body.bodyGeometricObject.position.x = 0;
            scene.add(body.bodyGeometricObject);
            for (var i = 0; i < body.cylinders.count; i++) {
                this.drawBodyCircle(currentCircleDiameter, currentCircleDiameter + diameterDiff, currentZ);
                currentCircleDiameter += diameterDiff;
                currentZ += 150;
            }
            this.renderThreeJSResults();

        },

        animate: function (figure) {
            var self = this;
            console.log(figure);
            figure.position.x += 50;
        },

        drawBodyCircle: function (startDiameter, endDiameter, z) {
            var bodyObject = this.settings.anatomy.body.bodyGeometricObject;
            var cylinder = new THREE.Mesh(new THREE.CylinderGeometry(startDiameter, endDiameter, 100, 50, 50, false), new THREE.MeshBasicMaterial({
                wireframe: true,
                color: 'blue'
            }));
            cylinder.position.x = 0;
            cylinder.position.y = 0;
            cylinder.position.z = z;
            cylinder.applyMatrix( new THREE.Matrix4().makeRotationX( Math.PI / 2 ) );
            bodyObject.add(cylinder);
        }
    };

    grampus.init();
</script>
</body>
</html>